{"version":3,"sources":["../src/setup.js"],"names":["define","$","moodleSettings","terms","authentication","setup","activeRequest","serviceToken","useRestProtocol","init","moodleSettingsHandler","termsHandler","unbind","on","hideErrors","loaderContainer","removeClass","save","response","addClass","status","JSON","parse","data","token","is","closeTab","openTab","showErrors","prop","attr","find","termsIsAccepted","authenticationHandler","showErrorMessage","email","val","setFormEmail","checkEmail","email_exists","showLoginForm","loginHandler","showRegisterForm","registerHandler","hideLoginForm","hideRegisterForm"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\n/**\r\n * This plugin provides access to Moodle data in form of analytics and reports in real time.\r\n *\r\n *\r\n * @package    local_intelliboard\r\n * @copyright  2020 IntelliBoard, Inc\r\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n * @website    https://intelliboard.net/\r\n */\r\n\r\ndefine([\r\n    \"jquery\",\r\n    \"local_intelliboard/setup_moodle_settings\",\r\n    \"local_intelliboard/setup_terms\",\r\n    \"local_intelliboard/setup_authentication\",\r\n], function($, moodleSettings, terms, authentication) {\r\n    var setup = {\r\n        activeRequest: false,\r\n        serviceToken: \"\",\r\n        useRestProtocol: true,\r\n        init: function() {\r\n            setup.moodleSettingsHandler();\r\n            setup.termsHandler();\r\n        },\r\n\r\n        moodleSettingsHandler: function() {\r\n            $(\".moodle-settings .tab-header-button button.next, .moodle-settings .tab-body-button button.next\").unbind(\"click\");\r\n            $(\".moodle-settings .tab-header-button button.next, .moodle-settings .tab-body-button button.next\").on(\"click\", function() {\r\n                if (setup.activeRequest) {\r\n                    return;\r\n                }\r\n\r\n                setup.activeRequest = true;\r\n                moodleSettings.hideErrors();\r\n                moodleSettings.loaderContainer.removeClass(\"hidden\");\r\n                moodleSettings.save(function(response) {\r\n                    setup.activeRequest = false;\r\n                    moodleSettings.loaderContainer.addClass(\"hidden\");\r\n\r\n                    if (response.status === \"success\") {\r\n                        setup.serviceToken = JSON.parse(response.data).token;\r\n                        setup.useRestProtocol = $(\"#rest_protocol\").is(\":checked\");\r\n                        moodleSettings.closeTab();\r\n                        terms.openTab();\r\n                    } else {\r\n                        moodleSettings.showErrors(response.data);\r\n                    }\r\n                });\r\n            });\r\n\r\n            $(\".moodle-settings .choose-group .item\").unbind(\"click\");\r\n            $(\".moodle-settings .choose-group .item\").on(\"click\", function() {\r\n                $(\".moodle-settings .choose-group .item\").removeClass(\"active\");\r\n                $(\".moodle-settings .choose-group .item input\").prop(\"checked\", false).attr(\"checked\", \"\");\r\n                $(this).addClass(\"active\");\r\n                $(this).find(\"input\").attr(\"checked\", \"checked\").prop(\"checked\", true);\r\n            });\r\n        },\r\n\r\n        termsHandler: function() {\r\n            $(\".tab-item.terms .tab-header-button button.next, .tab-item.terms .tab-body-button button.next\").unbind(\"click\");\r\n            $(\".tab-item.terms .tab-header-button button.next, .tab-item.terms .tab-body-button button.next\").on(\"click\", function() {\r\n                if (setup.activeRequest) {\r\n                    return;\r\n                }\r\n\r\n                terms.hideErrors();\r\n                terms.loaderContainer.removeClass(\"hidden\");\r\n\r\n                if (terms.termsIsAccepted()) {\r\n                    terms.loaderContainer.addClass(\"hidden\");\r\n                    terms.closeTab();\r\n                    setup.authenticationHandler();\r\n                } else {\r\n                    terms.showErrorMessage(function() {\r\n                        terms.loaderContainer.addClass(\"hidden\")\r\n                    });\r\n                }\r\n            });\r\n\r\n            $(\".tab-item.terms .tab-header-button button.back, .tab-item.terms .tab-body-button button.back\").on(\"click\", function() {\r\n                terms.closeTab();\r\n                moodleSettings.openTab();\r\n            });\r\n        },\r\n\r\n        authenticationHandler: function() {\r\n            var email = $(\"#subscription_email\").val();\r\n\r\n            authentication.openTab();\r\n            authentication.setFormEmail(email);\r\n            authentication.loaderContainer.removeClass(\"hidden\");\r\n            authentication.checkEmail(email, function (response) {\r\n                if (response.email_exists) {\r\n                    authentication.showLoginForm();\r\n                    authentication.loginHandler(setup.serviceToken, setup.useRestProtocol, function() {\r\n                        authentication.closeTab();\r\n                        $(\".setup-wrapper .tab-item.congrats\").removeClass(\"closed\");\r\n                    });\r\n                } else {\r\n                    authentication.showRegisterForm();\r\n                    authentication.registerHandler(setup.serviceToken, setup.useRestProtocol, function() {\r\n                        authentication.closeTab();\r\n                        $(\".setup-wrapper .tab-item.congrats\").removeClass(\"closed\");\r\n                    });\r\n                }\r\n            });\r\n\r\n            $(\".tab-item.authentication .tab-header-button button.back, .tab-item.authentication .tab-body-button button.back\").on(\"click\", function() {\r\n                authentication.closeTab();\r\n                authentication.hideLoginForm();\r\n                authentication.hideRegisterForm();\r\n                terms.openTab();\r\n            });\r\n        },\r\n    };\r\n\r\n    return setup;\r\n});"],"file":"setup.min.js"}