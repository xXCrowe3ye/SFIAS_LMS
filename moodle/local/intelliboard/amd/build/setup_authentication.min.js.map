{"version":3,"sources":["../src/setup_authentication.js"],"names":["define","$","ajax","validator","str","authentication","errorsContainer","loaderContainer","showErrors","errorsText","html","removeClass","hideErrors","addClass","closeTab","openTab","showLoginForm","hideLoginForm","showRegisterForm","hideRegisterForm","setFormEmail","email","val","checkEmail","callback","validateEmail","checkEmailPromises","call","methodname","args","done","response","fail","email_exists","loginHandler","token","useRestProtocol","unbind","on","password","allFieldsRequiredPromises","get_string","when","localizedEditString","loginPromises","moodle_service_token","restProtocol","status","message","stringPromises","registerHandler","name","registerPromises","country"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\n/**\r\n * This plugin provides access to Moodle data in form of analytics and reports in real time.\r\n *\r\n *\r\n * @package    local_intelliboard\r\n * @copyright  2020 IntelliBoard, Inc\r\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n * @website    https://intelliboard.net/\r\n */\r\n\r\ndefine([\r\n    \"jquery\", \"core/ajax\", \"local_intelliboard/validator\", \"core/str\"\r\n], function($, ajax, validator, str) {\r\n    var authentication = {\r\n        errorsContainer: $(\".tab-item.authentication .warnings-block\"),\r\n        loaderContainer: $(\".tab-item.authentication .loader\"),\r\n\r\n        showErrors: function(errorsText) {\r\n            authentication.errorsContainer.html(errorsText);\r\n            authentication.errorsContainer.removeClass(\"hidden\");\r\n        },\r\n\r\n        hideErrors: function() {\r\n            authentication.errorsContainer.html(\"\");\r\n            authentication.errorsContainer.addClass(\"hidden\");\r\n        },\r\n\r\n        closeTab: function() {\r\n            $(\".tab-item.authentication\").addClass(\"closed\");\r\n        },\r\n\r\n        openTab: function() {\r\n            $(\".tab-item.authentication\").removeClass(\"closed\");\r\n        },\r\n\r\n        showLoginForm: function() {\r\n            $(\".tab-item .tab-body .login-form\").removeClass(\"hidden\");\r\n        },\r\n\r\n        hideLoginForm: function() {\r\n            $(\".tab-item .tab-body .login-form\").addClass(\"hidden\");\r\n        },\r\n\r\n        showRegisterForm: function() {\r\n            $(\".tab-item .tab-body .register-form\").removeClass(\"hidden\");\r\n        },\r\n\r\n        hideRegisterForm: function() {\r\n            $(\".tab-item .tab-body .register-form\").addClass(\"hidden\");\r\n        },\r\n\r\n        setFormEmail: function(email) {\r\n            $(\"#loginEmail\").val(email);\r\n            $(\"#registerEmail\").val(email);\r\n        },\r\n\r\n        checkEmail: function(email, callback) {\r\n            if (validator.validateEmail(email)) {\r\n                var checkEmailPromises = ajax.call([{\r\n                    methodname: \"local_intelliboard_setup_check_email\", args: {\r\n                        email: $(\"#subscription_email\").val()\r\n                    }\r\n                }]);\r\n\r\n                checkEmailPromises[0].done(function(response) {\r\n                    callback(response);\r\n                });\r\n\r\n                checkEmailPromises[0].fail(function() {\r\n                    callback({email_exists: false});\r\n                });\r\n            } else {\r\n                callback({email_exists: false});\r\n            }\r\n        },\r\n\r\n        loginHandler: function(token, useRestProtocol, callback) {\r\n            authentication.loaderContainer.addClass(\"hidden\");\r\n\r\n            $(\".tab-body .login-form .sign-in\").unbind(\"click\");\r\n            $(\".tab-body .login-form .sign-in\").on(\"click\", function() {\r\n                var email = $(\"#loginEmail\").val();\r\n                var password = $(\"#loginPassword\").val();\r\n\r\n                authentication.loaderContainer.removeClass(\"hidden\");\r\n                authentication.hideErrors();\r\n\r\n                if (!email || !password) {\r\n                    var allFieldsRequiredPromises = str.get_string('all_fields_required', \"local_intelliboard\");\r\n\r\n                    $.when(allFieldsRequiredPromises).done(function(localizedEditString) {\r\n                        authentication.loaderContainer.addClass(\"hidden\");\r\n                        authentication.showErrors(localizedEditString);\r\n                    });\r\n                } else {\r\n                    var loginPromises = ajax.call([{\r\n                        methodname: \"local_intelliboard_setup_login\",\r\n                        args: {\r\n                            email: email,\r\n                            password: password,\r\n                            moodle_service_token: token,\r\n                            restProtocol: useRestProtocol,\r\n                        }\r\n                    }]);\r\n\r\n                    loginPromises[0].done(function(response) {\r\n                        authentication.loaderContainer.addClass(\"hidden\");\r\n\r\n                        if (response.status === \"error\") {\r\n                            authentication.showErrors(response.message);\r\n                        } else {\r\n                            callback();\r\n                        }\r\n                    });\r\n\r\n                    loginPromises[0].fail(function() {\r\n                        var stringPromises = str.get_string('server_error', \"local_intelliboard\");\r\n\r\n                        $.when(stringPromises).done(function(localizedEditString) {\r\n                            authentication.loaderContainer.addClass(\"hidden\");\r\n                            authentication.showErrors('<p>' + localizedEditString + '</p>');\r\n                        });\r\n                    });\r\n                }\r\n            });\r\n        },\r\n\r\n        registerHandler: function(token, useRestProtocol, callback) {\r\n            authentication.loaderContainer.addClass(\"hidden\");\r\n\r\n            $(\".tab-body .register-form .sign-up\").unbind(\"click\");\r\n            $(\".tab-body .register-form .sign-up\").on(\"click\", function() {\r\n                var email = $(\"#registerEmail\").val();\r\n                var password = $(\"#registerPassword\").val();\r\n                var name = $(\"#registerName\").val();\r\n\r\n                authentication.loaderContainer.removeClass(\"hidden\");\r\n                authentication.hideErrors();\r\n\r\n                if (!email || !password || !name) {\r\n                    var allFieldsRequiredPromises = str.get_string('all_fields_required', \"local_intelliboard\");\r\n\r\n                    $.when(allFieldsRequiredPromises).done(function(localizedEditString) {\r\n                        authentication.loaderContainer.addClass(\"hidden\");\r\n                        authentication.showErrors(localizedEditString);\r\n                    });\r\n                } else {\r\n                    var registerPromises = ajax.call([{\r\n                        methodname: \"local_intelliboard_setup_register\",\r\n                        args: {\r\n                            name: name,\r\n                            email: email,\r\n                            password: password,\r\n                            country: $(\"#registerCountry\").val(),\r\n                            moodle_service_token: token,\r\n                            restProtocol: useRestProtocol,\r\n                        }\r\n                    }]);\r\n\r\n                    registerPromises[0].done(function(response) {\r\n                        authentication.loaderContainer.addClass(\"hidden\");\r\n\r\n                        if (response.status === \"error\") {\r\n                            authentication.showErrors(response.message);\r\n                        } else {\r\n                            callback();\r\n                        }\r\n                    });\r\n\r\n                    registerPromises[0].fail(function() {\r\n                        var stringPromises = str.get_string('server_error', \"local_intelliboard\");\r\n\r\n                        $.when(stringPromises).done(function(localizedEditString) {\r\n                            authentication.loaderContainer.addClass(\"hidden\");\r\n                            authentication.showErrors('<p>' + localizedEditString + '</p>');\r\n                        });\r\n                    });\r\n                }\r\n            });\r\n        }\r\n    };\r\n\r\n    return authentication;\r\n});"],"file":"setup_authentication.min.js"}